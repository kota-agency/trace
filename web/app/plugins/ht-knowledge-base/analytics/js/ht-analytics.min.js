jQuery(document).ready(function($){"use strict";var beginDateStamp,endDateStamp,activePeriod,datePickerActive,monthlySearchesLineChart,monthlyViewsLineChart,totalSearchesDonutChart,exitSplitDonutChart,nullSearchesTable,topSearchesTable,exitsFromCategoriesTable,exitsFromArticlesTable,monthlyVisitsData={},totalSearchesData={},monthlySearchesData={},currentTab=hkbAnalyticsChart.tab,previousActivePeriod=hkbAnalyticsChart.userActivePeriod,dataLoaded=!1;$("#filterDate1").datepicker({dateFormat:hkbAnalyticsChart.dateFormat,onSelect:function(dateText){syncBeginDate(),updateAllStats(),updateUserMetaDates(),closeDatePicker()}});if($("#hkba-blocked-warning").hide(),hkbAnalyticsChart.userBeginDate){var userBeginDate=new Date(1e3*parseInt(hkbAnalyticsChart.userBeginDate));$("#filterDate1").datepicker("setDate",userBeginDate)}else{var lastMonth=new Date;lastMonth.setMonth(lastMonth.getMonth()-1),$("#filterDate1").datepicker("setDate",lastMonth)}function syncBeginDate(){$("#filterDate1").datepicker();var date=$("#filterDate1").datepicker("getDate");beginDateStamp=date.getTime()/1e3+parseInt(hkbAnalyticsChart.beginDateOffset)}syncBeginDate();$("#filterDate2").datepicker({dateFormat:hkbAnalyticsChart.dateFormat,onSelect:function(dateText){syncEndDate(),updateAllStats(),updateUserMetaDates(),closeDatePicker()}});if(hkbAnalyticsChart.userEndDate){var userEndDate=new Date(1e3*parseInt(hkbAnalyticsChart.userEndDate));$("#filterDate2").datepicker("setDate",userEndDate)}else{var thisMonth=new Date;$("#filterDate2").datepicker("setDate",thisMonth)}function syncEndDate(){$("#filterDate2").datepicker();var date=$("#filterDate2").datepicker("getDate");endDateStamp=date.getTime()/1e3+parseInt(hkbAnalyticsChart.endDateOffset)}function updateUserMetaDates(){$.ajax({url:ajaxurl,dataType:"JSON",data:{aq:"updateusermetadates",action:"hkba_dynamic_stats",nonce:getSecurity(".hkb-analyticsdate"),begin:beginDateStamp,end:endDateStamp,period:activePeriod},success:function(data){}})}function animateCounter(selector){$(selector).each(function(){var item=$(this),itemText=item.text();$.isNumeric(itemText)&&$({Counter:0}).animate({Counter:item.text()},{duration:1e3,easing:"swing",step:function(){item.text(Math.ceil(this.Counter))}})})}function filterFeedbackItems(){feedbackItems()}function getShowFilter(){var show="none";return $(".hkba-feedbackfilter__up").hasClass("active")&&(show="helpful"),$(".hkba-feedbackfilter__down").hasClass("active")&&(show="unhelpful"),$(".hkba-feedbackfilter__up").hasClass("active")&&$(".hkba-feedbackfilter__down").hasClass("active")&&(show="all"),show}function getCommentOnlyFilter(){var commentsFilter="all";return $(".hkba-feedbackfilter__comments").hasClass("active")&&(commentsFilter="commentsOnly"),commentsFilter}function enableFeedbackItemsPagination(){$("#hkba-feedback-pagination__prev_a").click(function(event){event.preventDefault(),loadPage($(event.target).attr("data-page-target"))}),$("#hkba-feedback-pagination__next_a").click(function(event){event.preventDefault(),loadPage($(event.target).attr("data-page-target"))})}function loadPage(targetPage){feedbackItems(targetPage)}function resetOrderClasses(){$(".hkba-feedbacktable__rating").removeClass("orderedby-asc orderedby-desc"),$(".hkba-feedbacktable__article").removeClass("orderedby-asc orderedby-desc"),$(".hkba-feedbacktable__feedback").removeClass("orderedby-asc orderedby-desc"),$(".hkba-feedbacktable__author").removeClass("orderedby-asc orderedby-desc"),$(".hkba-feedbacktable__date").removeClass("orderedby-asc orderedby-desc")}function getSortColumn(){var sortColumn="date";return $(".hkba-feedbacktable__rating").hasClass("orderedby-asc")&&(sortColumn="rating"),$(".hkba-feedbacktable__article").hasClass("orderedby-asc")&&(sortColumn="article"),$(".hkba-feedbacktable__feedback").hasClass("orderedby-asc")&&(sortColumn="feedback"),$(".hkba-feedbacktable__author").hasClass("orderedby-asc")&&(sortColumn="author"),$(".hkba-feedbacktable__date").hasClass("orderedby-asc")&&(sortColumn="date"),$(".hkba-feedbacktable__rating").hasClass("orderedby-desc")&&(sortColumn="rating"),$(".hkba-feedbacktable__article").hasClass("orderedby-desc")&&(sortColumn="article"),$(".hkba-feedbacktable__feedback").hasClass("orderedby-desc")&&(sortColumn="feedback"),$(".hkba-feedbacktable__author").hasClass("orderedby-desc")&&(sortColumn="author"),$(".hkba-feedbacktable__date").hasClass("orderedby-desc")&&(sortColumn="date"),sortColumn}function getSortOrder(){var sortOrder="asc",column=getSortColumn();return $(".hkba-feedbacktable__"+column).hasClass("orderedby-desc")&&(sortOrder="desc"),sortOrder}function setSortOrderOnClick(column){$(".hkba-feedbacktable__"+column).hasClass("orderedby-asc")?(resetOrderClasses(),$(".hkba-feedbacktable__"+column).addClass("orderedby-desc")):(resetOrderClasses(),$(".hkba-feedbacktable__"+column).addClass("orderedby-asc")),feedbackItems()}function enableFeedbackActionDDs(){$(".hkba-dd").each(function(index,listItem){const item=$(listItem);$(document).mouseup(e=>{item.is(e.target)||0!==item.has(e.target).length?($(".hkba-dd").removeClass("active"),item.addClass("active")):item.removeClass("active")})}),$(".hkba-feedback-remove").each(function(index,listItem){const feedbackItem=$(listItem),itemID=feedbackItem.attr("data-feedback-id"),articleID=feedbackItem.attr("data-article-id");feedbackItem.on("click",function(e){e.preventDefault(),$.ajax({url:ajaxurl,dataType:"JSON",data:{aq:"deletefeedbackitem",action:"hkba_dynamic_actions",nonce:getSecurity("#js-hkba-feedbackactions"),vid:itemID,pid:articleID},beforeSend:function(err){addLoadingClass("#js-hkba-feedbacktable")},success:function(data){data.success&&($("#hkba-feedback-item__"+itemID).animate({backgroundColor:"#aa0000",color:"#fff"},1e3),$("#hkba-feedback-item__"+itemID).animate({height:"1px"},2e3,function(){$("#hkba-feedback-item__"+itemID).remove()}))},complete:function(err){removeLoadingClass("#js-hkba-feedbacktable")}})})})}function feedbackItems(targetPage=1){!function($,Backbone,_,settings){var itemContentTemplate=document.getElementById("ht-analytics-item-template"),itemTemplate=_.template(itemContentTemplate.innerHTML),paginationContentTemplate=document.getElementById("ht-analytics-pagination-template"),paginationTemplate=_.template(paginationContentTemplate.innerHTML),feedbackNoItemsTemplate=document.getElementById("ht-analytics-no-items"),feedbackNoItems=_.template(feedbackNoItemsTemplate.innerHTML),feedbackSpinnerTemplate=document.getElementById("ht-analytics-spinner"),feedbackSpinner=_.template(feedbackSpinnerTemplate.innerHTML),page=targetPage,show=getShowFilter(),comments=getCommentOnlyFilter(),orderBy=getSortColumn(),order=getSortOrder();$("#js-hkba-feedbacktable").empty(),$("#js-hkba-feedbackpagination").empty(),$.ajax({url:ajaxurl,dataType:"JSON",data:{aq:"feedbackitems",action:"hkba_dynamic_stats",nonce:getSecurity("#js-hkba-feedbacktable"),begin:beginDateStamp,end:endDateStamp,page:page,show:show,comments:comments,order_by:orderBy,order:order},beforeSend:function(err){$("#js-hkba-feedbacktable").append(feedbackSpinner())},success:function(data){var index=0;if($("#js-hkba-feedbacktable").empty(),data.items.length>0){$.each(data.items,function(key,item){$("#js-hkba-feedbacktable").append(itemTemplate({feedback:item,index:index})),index++});data.totalCount;$("#js-hkba-feedbackpagination").append(paginationTemplate({totalCount:data.totalCount,page:data.page,pageCount:data.pageCount,hasPrev:data.hasPrev,hasNext:data.hasNext,prevPage:data.prev,nextPage:data.next})),enableFeedbackItemsPagination(),enableFeedbackActionDDs()}else $("#js-hkba-feedbacktable").append(feedbackNoItems())},complete:function(err){removeLoadingClass("#js-hkba-feedbacktable")}})}(jQuery,Backbone,_)}function updateAllStats(){var canvas;"dashboard"==currentTab?((canvas=$("#js-hkba-chart-kbviews")[0]).width=canvas.width,$("#js-hkba-chart-kbviews-info").empty(),$.ajax({url:ajaxurl,dataType:"JSON",data:{aq:"kboverviewmonthly",action:"hkba_dynamic_stats",nonce:getSecurity("#js-hkba-chart-kbviews"),begin:beginDateStamp,end:endDateStamp},beforeSend:function(err){addLoadingClass("#js-hkba-dash-views-panel")},success:function(data){if(monthlyVisitsData={labels:data.labels,datasets:[{label:data.searchesLabel,fillColor:"rgba(74, 136, 218,0.2)",strokeColor:"rgba(74, 136, 218,1.0)",pointColor:"rgba(74, 136, 218,1.0)",pointStrokeColor:"rgba(74, 136, 218,1.0)",pointHighlightFill:"rgba(52, 73, 94,1.0)",pointHighlightStroke:"rgba(52, 73, 94,1.0)",data:data.searches},{label:data.transfersLabel,fillColor:"rgba(232, 85, 62,0.2)",strokeColor:"rgba(232, 85, 62,1.0)",pointColor:"rgba(232, 85, 62,1.0)",pointStrokeColor:"(232, 85, 62,1.0)",pointHighlightFill:"rgba(52, 73, 94,1.0)",pointHighlightStroke:"rgba(52, 73, 94,1.0)",data:data.transfers}]},0!=data.searches.length){var ctx1=$("#js-hkba-chart-kbviews").get(0).getContext("2d");ctx1.canvas.originalwidth=ctx1.canvas.width,ctx1.canvas.originalheight=ctx1.canvas.height;try{monthlyViewsLineChart.destroy()}catch(err){}ctx1.canvas.width=500,ctx1.canvas.height=500;var legend=(monthlyViewsLineChart=new Chart(ctx1).Line(monthlyVisitsData,{responsive:!0,maintainAspectRatio:!1,legendTemplate:'<ul class="hkb-chart-legend"><% for (var i=0; i<datasets.length; i++) { %><li><span></span><% if (datasets[i].label) { %><%= datasets[i].label %><% } %></li><% } %></ul>'})).generateLegend();$("#js-hkba-chart-kbviews-info").append(legend)}else $("#js-hkba-chart-kbviews-info").append('<span class="no-results">'+hkbAnalyticsChart.notEnoughResultsString+"</div>")},error:function(err){},complete:function(err){removeLoadingClass("#js-hkba-dash-views-panel")}}),$.ajax({url:ajaxurl,dataType:"JSON",data:{aq:"feedbackoverview",action:"hkba_dynamic_stats",nonce:getSecurity("#js-hkba-feedbacksummary"),begin:beginDateStamp,end:endDateStamp},beforeSend:function(err){addLoadingClass("#js-hkba-dash-articles-panel")},success:function(data){$("#js-hkba-feedbacksummary-helpful").html(data.totalUp),$("#js-hkba-feedbacksummary-unhelpful").html(data.totalDown),$("#js-hkba-feedbacksummary-success").html(data.feedbackArticleSuccess),$(".hkb-dashboardfeedback__summary").removeClass("hkb-dashboardfeedback__summary--neutral"),$(".hkb-dashboardfeedback__summary").removeClass("hkb-dashboardfeedback__summary--good"),$(".hkb-dashboardfeedback__summary").removeClass("hkb-dashboardfeedback__summary--bad"),data.feedbackArticleSuccess>55?$(".hkb-dashboardfeedback__summary").addClass("hkb-dashboardfeedback__summary--good"):data.feedbackArticleSuccess<=55&&data.feedbackArticleSuccess>=45?$(".hkb-dashboardfeedback__summary").addClass("hkb-dashboardfeedback__summary--neutral"):$(".hkb-dashboardfeedback__summary").addClass("hkb-dashboardfeedback__summary--bad"),animateCounter("#js-hkba-feedbacksummary-helpful"),animateCounter("#js-hkba-feedbacksummary-unhelpful"),animateCounter("#js-hkba-feedbacksummary-success")},complete:function(err){removeLoadingClass("#js-hkba-dash-articles-panel")}}),$.ajax({url:ajaxurl,dataType:"JSON",data:{aq:"searchesoverview",action:"hkba_dynamic_stats",nonce:getSecurity(" #js-hkba-searchsummary"),begin:beginDateStamp,end:endDateStamp},beforeSend:function(err){addLoadingClass("#js-hkba-dash-search-panel")},success:function(data){$("#js-hkba-searchsummary-total").html(data.totalSearches),$("#js-hkba-searchsummary-failed").html(data.totalNull),$("#js-hkba-searchsummary-success").html(data.feedbackSuccess),$(".hkb-dashboardsearcheffect__summary").removeClass("hkb-dashboardsearcheffect__summary--neutral"),$(".hkb-dashboardsearcheffect__summary").removeClass("hkb-dashboardsearcheffect__summary--good"),$(".hkb-dashboardsearcheffect__summary").removeClass("hkb-dashboardsearcheffect__summary--bad"),data.feedbackSuccess>55?$(".hkb-dashboardsearcheffect__summary").addClass("hkb-dashboardsearcheffect__summary--good"):data.feedbackSuccess<=55&&data.feedbackSuccess>=45?$(".hkb-dashboardsearcheffect__summary").addClass("hkb-dashboardfeedback__summary--neutral"):$(".hkb-dashboardsearcheffect__summary").addClass("hkb-dashboardsearcheffect__summary--bad"),animateCounter("#js-hkba-searchsummary-total"),animateCounter("#js-hkba-searchsummary-failed"),animateCounter("#js-hkba-searchsummary-success")},complete:function(err){removeLoadingClass("#js-hkba-dash-search-panel")}})):"articles"==currentTab||("feedback"==currentTab?($.ajax({url:ajaxurl,dataType:"JSON",data:{aq:"feedbackresponses",action:"hkba_dynamic_stats",nonce:getSecurity(".hkb-feedbackbar__block"),begin:beginDateStamp,end:endDateStamp},beforeSend:function(err){addLoadingClass("#js-hkba-feedback-overview-panel")},success:function(data){$(".hkb-feedbackbar_count").html(data.totalResponses),$(".hkb-feedbackbar_good").attr("data-hkb-feedbacknum",data.totalUp),$(".hkb-feedbackbar_good").attr("style","width: "+data.feedbackGoodWidth+"%"),$(".hkb-feedbackbar_bad").attr("data-hkb-feedbacknum",data.totalDown),$(".hkb-feedbackbar_bad").attr("style","width: "+data.feedbackBadWidth+"%")},complete:function(err){removeLoadingClass("#js-hkba-feedback-overview-panel")}}),feedbackItems()):"search"==currentTab?(!function(){var canvas=$("#js-hkba-chart-searchoverview")[0];canvas.width=canvas.width,$("#js-hkba-chart-searchoverview-info").empty(),$.ajax({url:ajaxurl,dataType:"JSON",data:{aq:"totalsearches",action:"hkba_dynamic_stats",nonce:getSecurity("#js-hkba-chart-searchoverview"),begin:beginDateStamp,end:endDateStamp},beforeSend:function(err){addLoadingClass("#js-hkba-search-overview-panel")},success:function(data){if(totalSearchesData=[{value:data.totalPopulated,color:"#85c468",highlight:"#9ed26a",label:hkbAnalyticsChart.returnedResultsString},{value:data.totalNULL,color:"#e8553e",highlight:"#fa6c51",label:hkbAnalyticsChart.noResultsString}],0!=data.totalSearches){var ctx=$("#js-hkba-chart-searchoverview").get(0).getContext("2d");try{totalSearchesDonutChart.destroy()}catch(err){}var legend=(totalSearchesDonutChart=new Chart(ctx).Doughnut(totalSearchesData,{responsive:!0,maintainAspectRatio:!1,percentageInnerCutout:50,segmentShowStroke:!1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'})).generateLegend();$("#js-hkba-chart-searchoverview-info").append(legend)}else $("#js-hkba-chart-searchoverview-info").append('<span class="no-results">'+hkbAnalyticsChart.notEnoughResultsString+"</div>")},complete:function(err){removeLoadingClass("#js-hkba-search-overview-panel")}})}(),function(){var canvas=$("#js-hkba-chart-kbsearches")[0];canvas.width=canvas.width,$("#js-hkba-chart-kbsearches-info").empty(),$.ajax({url:ajaxurl,dataType:"JSON",data:{aq:"searchmonthly",action:"hkba_dynamic_stats",nonce:getSecurity("#js-hkba-chart-kbsearches"),begin:beginDateStamp,end:endDateStamp},beforeSend:function(err){addLoadingClass("#js-hkba-search-period-panel")},success:function(data){if(monthlySearchesData={labels:data.labels,datasets:[{fillColor:"rgba(74, 136, 218,0.2)",strokeColor:"rgba(74, 136, 218,1.0)",pointColor:"rgba(74, 136, 218,1.0)",pointStrokeColor:"rgba(74, 136, 218,1.0)",pointHighlightFill:"rgba(52, 73, 94,1.0)",pointHighlightStroke:"rgba(52, 73, 94,1.0)",data:data.values}]},0!=data.values.length){var ctx1=$("#js-hkba-chart-kbsearches").get(0).getContext("2d");ctx1.canvas.originalwidth=ctx1.canvas.width,ctx1.canvas.originalheight=ctx1.canvas.height;try{monthlySearchesLineChart.destroy()}catch(err){}ctx1.canvas.width=200,ctx1.canvas.height=200,monthlySearchesLineChart=new Chart(ctx1).Line(monthlySearchesData,{responsive:!0,maintainAspectRatio:!1})}else $("#js-hkba-chart-kbsearches-info").append('<span class="no-results">'+hkbAnalyticsChart.notEnoughResultsString+"</div>")},error:function(err){},complete:function(err){removeLoadingClass("#js-hkba-search-period-panel")}})}(),nullSearchesTable.ajax.reload(),topSearchesTable.ajax.reload()):"authors"==currentTab||"exits"==currentTab&&($.ajax({url:ajaxurl,dataType:"JSON",data:{aq:"exitsoverview",action:"hkba_dynamic_stats",nonce:getSecurity("#js-hkba-transfersummary"),begin:beginDateStamp,end:endDateStamp},beforeSend:function(err){addLoadingClass("#js-hkba-tranfers-metrics-panel")},success:function(data){$("#js-hkba-transfersummary-totalviews").html(data.views),$("#js-hkba-transfersummary-totalviews").attr("title",data.vlabel),$("#js-hkba-transfersummary-totalviews").next(".hkb-transfermetrics__label").attr("title",data.vlabel),$("#js-hkba-transfersummary-totalexits").html(data.exits),$("#js-hkba-transfersummary-totalexits").attr("title",data.elabel),$("#js-hkba-transfersummary-totalexits").next(".hkb-transfermetrics__label").attr("title",data.elabel),$("#js-hkba-transfersummary-success").html(data.percentage),$("#js-hkba-transfersummary-success").attr("title",data.plabel),$(".hkb-transfermetrics__summaryvalue").attr("title",data.plabel)},complete:function(err){removeLoadingClass("#js-hkba-tranfers-metrics-panel")}}),function(){var canvas=$("#js-hkba-chart-transferoverview")[0];canvas.width=canvas.width,$("#js-hkba-chart-transferoverview-info").empty(),$.ajax({url:ajaxurl,dataType:"JSON",data:{aq:"exitssplit",action:"hkba_dynamic_stats",nonce:getSecurity("#js-hkba-chart-transferoverview"),begin:beginDateStamp,end:endDateStamp},beforeSend:function(err){addLoadingClass("#js-hkba-tranfers-split-panel")},success:function(data){if(0!=data.length){var ctx=$("#js-hkba-chart-transferoverview").get(0).getContext("2d");try{exitSplitDonutChart.destroy()}catch(err){}exitSplitDonutChart=new Chart(ctx).Doughnut({},{showTooltips:!0,tooltipTemplate:"<%=label%>"}),data.forEach(function(group){exitSplitDonutChart.addData({value:group.exitPercentage,color:group.color,highlight:"#C69CBE",label:group.label})},this);var legend=exitSplitDonutChart.generateLegend();$("#js-hkba-chart-transferoverview-info").append(legend),exitSplitDonutChart.update()}else $("#js-hkba-chart-transferoverview-info").append('<span class="no-results">'+hkbAnalyticsChart.notEnoughResultsString+"</div>")},complete:function(err){removeLoadingClass("#js-hkba-tranfers-split-panel")}})}(),exitsFromCategoriesTable.ajax.reload(),exitsFromArticlesTable.ajax.reload())),dataLoaded=!0}function getSecurity(id){return $(id).data("nonce")}function setTimePeriod(period){switch(removeAllActivePeriods(),activePeriod=period,period){case"all-time":dateBase=new Date,$("#filterDate2").datepicker("setDate",dateBase),dateBase.setYear(dateBase.getFullYear()-5),$("#filterDate1").datepicker("setDate",dateBase),syncBeginDate(),syncEndDate(),updateAllStats(),updateUserMetaDates(),$("#hkb-period__all-time-btn").parent("li").addClass("active");break;case"last-12-months":!function(){var dateBase=new Date;$("#filterDate2").datepicker("setDate",dateBase),dateBase.setMonth(dateBase.getMonth()-12),$("#filterDate1").datepicker("setDate",dateBase),syncBeginDate(),syncEndDate(),updateAllStats(),updateUserMetaDates(),$("#hkb-period__last-12-months-btn").parent("li").addClass("active")}();break;case"last-90-days":!function(){var dateBase=new Date;$("#filterDate2").datepicker("setDate",dateBase),dateBase.setDate(dateBase.getDate()-90),$("#filterDate1").datepicker("setDate",dateBase),syncBeginDate(),syncEndDate(),updateAllStats(),updateUserMetaDates(),$("#hkb-period__last-90-days-btn").parent("li").addClass("active")}();break;case"last-30-days":setTimePeriodLastThirtyDays();break;case"last-7-days":!function(){var dateBase=new Date;$("#filterDate2").datepicker("setDate",dateBase),dateBase.setDate(dateBase.getDate()-7),$("#filterDate1").datepicker("setDate",dateBase),syncBeginDate(),syncEndDate(),updateAllStats(),updateUserMetaDates(),$("#hkb-period__last-7-days-btn").parent("li").addClass("active")}();break;case"custom-period":!function(){dataLoaded||(syncBeginDate(),syncEndDate(),updateAllStats(),updateUserMetaDates());$("#hkb-period__custom-period-btn").parent("li").addClass("active"),datePickerActive=!0,$("#hkb-period__custom-period-ul").attr("data-ht-visibility","true")}()}var dateBase}function setTimePeriodLastThirtyDays(){var dateBase=new Date;$("#filterDate2").datepicker("setDate",dateBase),dateBase.setDate(dateBase.getDate()-30),$("#filterDate1").datepicker("setDate",dateBase),syncBeginDate(),syncEndDate(),updateAllStats(),updateUserMetaDates(),$("#hkb-period__last-30-days-btn").parent("li").addClass("active")}function closeDatePicker(){$("#hkb-period__custom-period-ul").attr("data-ht-visibility","false")}function removeAllActivePeriods(){$(".hkba-period li").removeClass("active")}function addLoadingClass(targetElementSelector){$(targetElementSelector).addClass("loading")}function removeLoadingClass(targetElementSelector){$(targetElementSelector).removeClass("loading")}function equalheight(container){var $el,currentTallest=0,currentRowStart=0,rowDivs=new Array;$(container).each(function(){$el=$(this),$($el).height("auto");var topPostion=$el.position().top;if(currentRowStart!=topPostion){for(var currentDiv=0;currentDiv<rowDivs.length;currentDiv++)rowDivs[currentDiv].height(currentTallest);rowDivs.length=0,currentRowStart=topPostion,currentTallest=$el.height(),rowDivs.push($el)}else rowDivs.push($el),currentTallest=currentTallest<$el.height()?$el.height():currentTallest;for(currentDiv=0;currentDiv<rowDivs.length;currentDiv++)rowDivs[currentDiv].height(currentTallest)})}syncEndDate(),$(".hkba-feedbackfilter__up").click(function(event){event.preventDefault(),$(this).toggleClass("active"),filterFeedbackItems()}),$(".hkba-feedbackfilter__down").click(function(event){event.preventDefault(),$(this).toggleClass("active"),filterFeedbackItems()}),$(".hkba-feedbackfilter__comments").click(function(event){$(this).toggleClass("active"),filterFeedbackItems()}),$(".hkba-feedbacktable__rating").click(function(event){setSortOrderOnClick("rating")}),$(".hkba-feedbacktable__article").click(function(event){setSortOrderOnClick("article")}),$(".hkba-feedbacktable__feedback").click(function(event){setSortOrderOnClick("feedback")}),$(".hkba-feedbacktable__author").click(function(event){setSortOrderOnClick("author")}),$(".hkba-feedbacktable__date").click(function(event){setSortOrderOnClick("date")}),$("#hkb-period__all-time-btn").click(function(event){event.preventDefault(),setTimePeriod("all-time")}),$("#hkb-period__last-12-months-btn").click(function(event){event.preventDefault(),setTimePeriod("last-12-months")}),$("#hkb-period__last-90-days-btn").click(function(event){event.preventDefault(),setTimePeriod("last-90-days")}),$("#hkb-period__last-30-days-btn").click(function(event){event.preventDefault(),setTimePeriod("last-30-days")}),$("#hkb-period__last-7-days-btn").click(function(event){event.preventDefault(),setTimePeriod("last-7-days")}),$("#hkb-period__custom-period-btn").click(function(event){event.preventDefault(),setTimePeriod("custom-period")}),$(document).on("click",function(e){if(datePickerActive){var target=e.target,id=target.id,isDateArea="filterDate1"==id||"filterDate2"==id||"hkb-period__custom-period-ul"==id||"hkb-period__custom-period-btn"==id,jTarget=$(target),childOfDateArea=$("#hkb-period__custom-period-ul").find(jTarget).length>0,isDatePicker1Open=$("#filterDate1").datepicker("widget").is(":visible"),isDatePicker2Open=$("#filterDate2").datepicker("widget").is(":visible");isDateArea||childOfDateArea||isDatePicker1Open||isDatePicker2Open||(closeDatePicker(),datePickerActive=!1)}else closeDatePicker(),datePickerActive=!1}),$(document).ready(function(){$("table.recent-feedback-result").DataTable({ajax:{url:ajaxurl,data:function(d){d.aq="recentfeedback",d.action="hkba_dynamic_stats",d.begin=beginDateStamp,d.end=endDateStamp,d.nonce=getSecurity(".recent-feedback-result")}},order:[[1,"desc"]],responsive:!0}),nullSearchesTable=$("table.null-searches-result").DataTable({ajax:{url:ajaxurl,data:function(d){d.aq="nullsearches",d.action="hkba_dynamic_stats",d.begin=beginDateStamp,d.end=endDateStamp,d.nonce=getSecurity(".null-searches-result")},beforeSend:function(err){addLoadingClass("#js-hkba-search-null-panel")},complete:function(err){removeLoadingClass("#js-hkba-search-null-panel")}},order:[[1,"desc"]],searching:!1,lengthChange:!1,pageLength:10,columnDefs:[{targets:0,orderable:!1}],responsive:!0}),topSearchesTable=$("table.top-searches-result").DataTable({ajax:{url:ajaxurl,data:function(d){d.aq="topsearches",d.action="hkba_dynamic_stats",d.begin=beginDateStamp,d.end=endDateStamp,d.nonce=getSecurity(".top-searches-result")},beforeSend:function(err){addLoadingClass("#js-hkba-search-popular-panel")},complete:function(err){removeLoadingClass("#js-hkba-search-popular-panel")}},order:[[1,"desc"]],searching:!1,lengthChange:!1,pageLength:10,columnDefs:[{targets:0,orderable:!1}],responsive:!0}),exitsFromCategoriesTable=$("table.category-exits-result").DataTable({ajax:{url:ajaxurl,data:function(d){d.aq="exitsfromcats",d.action="hkba_dynamic_stats",d.begin=beginDateStamp,d.end=endDateStamp,d.nonce=getSecurity(".category-exits-result")}},order:[[1,"desc"]],searching:!1,lengthChange:!1,pageLength:10,columnDefs:[{targets:0,orderable:!1}],responsive:!0}),exitsFromArticlesTable=$("table.article-exits-result").DataTable({ajax:{url:ajaxurl,data:function(d){d.aq="exitsfromarticles",d.action="hkba_dynamic_stats",d.begin=beginDateStamp,d.end=endDateStamp,d.nonce=getSecurity(".article-exits-result")}},order:[[1,"desc"]],searching:!1,lengthChange:!1,pageLength:10,columnDefs:[{targets:0,orderable:!1}],responsive:!0}),""!=previousActivePeriod?(removeAllActivePeriods(),$("#hkb-period__"+previousActivePeriod+"-btn").parent("li").addClass("active"),setTimePeriod(previousActivePeriod)):setTimePeriodLastThirtyDays()}),$(window).load(function(){equalheight(".hkb-grid__col .hkba-panel--equalheight")}),$(window).resize(function(){equalheight(".hkb-grid__col .hkba-panel--equalheight")})});