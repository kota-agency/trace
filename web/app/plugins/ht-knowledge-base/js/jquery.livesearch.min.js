jQuery.fn.liveSearch=function(conf){var config=jQuery.extend({url:"/search-results.php?q=",id:"jquery-live-search",duration:400,typeDelay:200,triggerLength:4,loadingClass:"live-search-loading",onSlideUp:function(){},onShowLiveSearch:function(){},uptadePosition:!1,keepTypingPrompt:"keep typing"},conf),liveSearch=jQuery("#"+config.id);return liveSearch.length||(liveSearch=jQuery('<div id="'+config.id+'"></div>').appendTo(document.body).hide().slideUp(0),jQuery(document.body).click(function(event){var clicked=jQuery(event.target);clicked.is("#"+config.id)||clicked.parents("#"+config.id).length||clicked.is("input")||liveSearch.slideUp(config.duration,function(){config.onSlideUp()})})),this.each(function(){jQuery(this).bind("hideLiveSearch",function(){hideLiveSearch()});var input=jQuery(this).attr("autocomplete","off"),liveSearchPaddingBorderHoriz=parseInt(liveSearch.css("paddingLeft"),10)+parseInt(liveSearch.css("paddingRight"),10)+parseInt(liveSearch.css("borderLeftWidth"),10)+parseInt(liveSearch.css("borderRightWidth"),10),repositionLiveSearch=function(){var tmpOffset=input.offset(),inputDim={left:tmpOffset.left,top:tmpOffset.top,width:input.outerWidth(),height:input.outerHeight()};inputDim.topPos=inputDim.top+inputDim.height,inputDim.totalWidth=inputDim.width-liveSearchPaddingBorderHoriz,liveSearch.css({position:"absolute",left:inputDim.left+"px",top:inputDim.topPos+"px",width:inputDim.totalWidth+"px"})},showLiveSearch=function(){input.attr("aria-expanded","true"),jQuery(this).attr("aria-expanded","true"),jQuery("#s").attr("aria-expanded","true"),repositionLiveSearch(),jQuery(window).unbind("resize",repositionLiveSearch),jQuery(window).bind("resize",repositionLiveSearch),config.onShowLiveSearch(),liveSearch.slideDown(config.duration)},hideLiveSearch=function(){liveSearch.slideUp(config.duration,function(){config.onSlideUp(),input.attr("aria-expanded","false"),jQuery(this).attr("aria-expanded","false"),jQuery("#s").attr("aria-expanded","false")})};input.focus(function(){""!==this.value&&(""===liveSearch.html()?(this.lastValue="",input.keyup()):setTimeout(showLiveSearch,1))}).keyup(function(){if(0==this.value.length)return this.timer&&clearTimeout(this.timer),hideLiveSearch(),void(this.lastValue=this.value);if(this.value.length<=config.triggerLength)return this.timer&&clearTimeout(this.timer),liveSearch.html(config.keepTypingPrompt),showLiveSearch(),void(this.lastValue=this.value);if(this.value!=this.lastValue){input.addClass(config.loadingClass);var q=encodeURIComponent(this.value);this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){jQuery.get(config.url+q,function(data){input.removeClass(config.loadingClass),data.length&&q.length?(liveSearch.html(data),showLiveSearch()):hideLiveSearch()})},config.typeDelay),this.lastValue=this.value}})})};