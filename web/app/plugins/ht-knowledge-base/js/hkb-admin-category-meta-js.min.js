jQuery(document).ready(function($){"use strict";var meta_image=window.meta_image,wp=window.wp;function clearCategoryImage(){$("input#meta-image").val(""),$("#meta-image-preview").attr("src",meta_image.no_image)}function hideCategoryImage(){clearCategoryImage(),$("#meta-image-preview").hide()}function showCategoryImage(){$("input#meta-svg").val(""),$("input#meta-svg-color").val(""),$("#ht-kb-svg-preview").html(""),$("#ht-kb-svg-preview").hide(),$("#meta-image-preview").show()}function showSVG(){hideCategoryImage(),$("#ht-kb-svg-preview").show()}function getSelectedColor(){return $(".icon-color").val()}$("#meta-image-button").click(function(e){e.preventDefault(),void 0!==wp&&wp.media&&wp.media.editor&&wp.media.editor.open("meta-image-button"),window.currentEditor=wp.media.editor.get("meta-image-button");wp.media.editor.send.attachment;wp.media.editor.send.attachment=function(a,b){if(b.hasOwnProperty("id")&&($("input#meta-image").val(b.id),showCategoryImage(),b.hasOwnProperty("sizes"))){var sizes=b.sizes,thumbnail=null;sizes.hasOwnProperty("thumbnail")?(thumbnail=sizes.thumbnail.url,$("#meta-image-preview").attr("src",thumbnail)):(thumbnail=sizes.full.url,$("#meta-image-preview").attr("src",thumbnail))}},window.original_send_to_editor=window.send_to_editor,window.send_to_editor=function(html){}}),$("#meta-image-remove").click(function(e){e.preventDefault(),clearCategoryImage(),showCategoryImage()}),$(".meta-color").wpColorPicker(),""!==$("input#meta-svg").val()?showSVG():showCategoryImage(),$("form#addtag input#submit").click(function(event){event.preventDefault(),clearCategoryImage(),showCategoryImage()}),$(document.body).on("click","#meta-image-button",function(event){var kbIconTabTriggered=0;if(0===kbIconTabTriggered){var searchText=meta_image.activate_tab_text||"";$(".media-menu-item").filter(function(){return $(this).text().toLowerCase().indexOf(searchText.toLowerCase())>=0}).first().trigger("click"),kbIconTabTriggered=1}}),$(document.body).on("click","li.ht-kb-icon",function(event){event.preventDefault(),$("li.ht-kb-icon.active").removeClass("active"),$(this).addClass("active"),$("button.media-button-select").on("change",function(event){event.preventDefault()}),$("button.media-button-select").prop("disabled",!1)}),$(document.body).on("click","button.media-button-select",function(event){showSVG();var icon=$("li.ht-kb-icon.active").html(),color=getSelectedColor();$("#ht-kb-svg-preview").show(),$("#ht-kb-svg-preview").html(icon),$("input#meta-svg").val(icon),$("input#meta-svg-color").val(color),hideCategoryImage(),window.currentEditor.close()});wp.media.view.EmbedUrl;var View=wp.media.View,embedIcon=View.extend({tagName:"label",className:"add-ht-kb-icon",template:wp.template("hkb-icons"),events:{input:"icon",keyup:"icon",change:"icon"},initialize:function(){this.model.get("icon")&&_.delay(_.bind(function(){this.model.trigger("change:icon")},this),500),this.render()},render:function(){return this.model.set("icon","test"),View.prototype.render.apply(this,arguments),initIconColorPicker(),this},icon:function(event){this.model.set("icon","test")},focus:function(){var $input=this.$input;$input.is(":visible")&&$input.focus()[0].select()}}),oldMediaFrame=wp.media.view.MediaFrame.Post;function setIconColor(color){$(".hkbiconsvg-stroke").css("stroke",color),$(".hkbiconsvg-fill").css("fill",color)}function initIconColorPicker(){$(".icon-color").wpColorPicker({change:function(event,ui){event.target;var color=ui.color.toString();setIconColor(color),$(".icon-color").val(color)}})}wp.media.view.MediaFrame.Post=oldMediaFrame.extend({initialize:function(){oldMediaFrame.prototype.initialize.apply(this,arguments);var handlers;this.options;this.states.add([new wp.media.controller.Embed({id:"ht-kb-icon",title:"Knowledge Base Icon",content:"icon"})]),handlers={content:{icon:"iconContent"}},_.each(handlers,function(regionHandlers,region){_.each(regionHandlers,function(callback,handler){this.on(region+":render:"+handler,this[callback],this)},this)},this)},iconContent:function(){var view=new embedIcon({controller:this,model:this.state()}).render();this.content.set(view);var setColor=$("input#meta-svg-color").val()||"#000";$(".icon-color").val(setColor),setIconColor(getSelectedColor()),initIconColorPicker()},destroy:function(){}})});